<!DOCTYPE html>
<html>
<head>
    <title>Noahs Math tools</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
body, html {
    margin: 0;
    height: 100%;
    overflow: hidden;

    background: linear-gradient(45deg, #000000, #ff7a00);
    background-size: 300% 300%;
    animation: bgShift 12s ease infinite;
}

@keyframes bgShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

        #box {
            color: #aaa;
            height: 20em;
            width: 30em;
            max-width: 80%;
            max-height: 80%;
            background-color: #333;
            border-radius: 0.4em;
            border: 2px solid #555;
            position: relative;
            transition-duration: 0.2s;
            overflow: hidden;
            font-weight: bold;
            font-size: 20px;
            margin: 5px;
            text-align: center;
            padding: 10px;
        }

        #box:hover, #box[drag] {
            border-color: #1AAFFF;
            color: #ddd;
        }

        #input {
            cursor: pointer;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
        }

        #top {
            margin: 5px;
        }

        select, button {
            padding: 0.6em 0.4em;
            margin: 0.5em;
            width: 15em;
            max-width: 100%;
            font-weight: bold;
            font-size: 16px;
            background-color: #444;
            color: #aaa;
            border-radius: 0.4em;
            border: 1px solid #555;
            cursor: pointer;
            transition-duration: 0.2s;
        }

        select:hover, button:hover {
            background-color: #666;
            color: #ddd;
        }
    </style>
</head>

<body>

    <div id="top"><br></div>

    <div id="box">
        <input type="file" id="input" title="Upload" />
        Drag ROM file or click here
    </div>

    <script>
        /* Gradient Animation already defined above */

        let enableDebug = false;
        let enableThreads = false;
        let browserMode;

        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        if (parseInt(urlParams.get("debug")) === 1 || urlParams.get("debug") === "true") {
            enableDebug = true;
            console.log("Debug is enabled");
        } else {
            console.log("Debug is disabled");
        }

        if (parseInt(urlParams.get("threads")) === 1 || urlParams.get("threads") === "true") {
            if (window.SharedArrayBuffer) {
                enableThreads = true;
                console.log("Threads are enabled");
            } else {
                console.warn("Threads require cross-origin isolation.");
            }
        } else {
            console.log("Threads are disabled");
        }

        if (urlParams.get("browserMode")) {
            browserMode = urlParams.get("browserMode");
        }

        if (urlParams.get("rom")) {
            console.log(`Loading ROM from URL: roms/${urlParams.get("rom")}`);
            run(false, urlParams.get("rom"));
        }

        async function run(upload, file) {
            const url = upload ? input.files[0] : `roms/${file}`;
            const parts = upload ? input.files[0].name.split(".") : file.split(".");

            const core = await (async (ext) => {
                if (["fds","nes","unif","unf"].includes(ext)) return "nes";
                if (["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"].includes(ext)) return "snes";
                if (["z64","n64"].includes(ext)) return "n64";
                if (["pce"].includes(ext)) return "pce";
                if (["ngp","ngc"].includes(ext)) return "ngp";
                if (["ws","wsc"].includes(ext)) return "ws";
                if (["col","cv"].includes(ext)) return "coleco";
                if (["d64"].includes(ext)) return "vice_x64sc";
                if (["md","sg","smd","gen"].includes(ext)) return "segaMD";
                if (["nds","gba","gb","z64","n64"].includes(ext)) return ext;

                return await new Promise(resolve => {
                    var coreValues = {
                        "Nintendo 64": "n
